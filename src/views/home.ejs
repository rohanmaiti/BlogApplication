<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="">
    <%- include("./partials/head")  %>
    <style>
        body{
            background-color:rgb(31, 31, 33);  
            color: white;
        }
        .container {
        overflow-y: auto;  /* Enables vertical scrollbar */
        overflow-x: hidden; /* Hides horizontal scrollbar */
        scrollbar-width: thin;  /* Firefox: Makes scrollbar thinner */
        scrollbar-color: #e0e0e0 #484848;  /* Firefox: Thumb and Track color */
        display: flex;
        flex-direction: column;
        gap: 5px;
        }

        /* WebKit Browsers (Chrome, Edge, Safari) */
        .container::-webkit-scrollbar {
            width: 8px; /* Thin vertical scrollbar */
        }
        .container::-webkit-scrollbar-track {
            background: #f1f1f1; /* Light background for track */
            border-radius: 10px;
        }

        .container::-webkit-scrollbar-thumb {
            background: #888; /* Scrollbar color */
            border-radius: 10px;
        }

        .container::-webkit-scrollbar-thumb:hover {
            background: #555; /* Darker on hover */
        }
        .btn{
        background-color: rgb(15, 126, 117);
        color: #f1f1f1;
        }
        .btn:hover{
        background-color: blue;
        }
        .custom-textarea {
            min-height: 300px !important;  /* Increase height */
            font-size: 16px !important;  /* Increase font size */
            padding: 10px !important;  /* Add padding */
        }
        .comment{
            display: hide;
        }
        .hide{
            display: block;
        }
        .noBlog{
            display: none;
            text-align: center;
            margin-top:10% ;
        }

    </style>
</head>
<body>
   <%- include("./partials/navbar") %>
   <div class="noBlog">
    <h1>No Blog is Here</h1>
   </div>
   <div class="container"> </div>
   <%- include("./partials/script") %>
    <script>
            const user = <%- JSON.stringify(user) %>; 
            // console.log("user =", user);

            // FETCHING ALL BLOGS AND CREATING BOX FOR THIS  <START>
            fetch("/user/blog/allBlogs")
            .then(res=>res.json())
            .then(blogs=>{
                // console.log(blogs);
                if(blogs.blogs.length == 0){
                    document.querySelector(".noBlog").style = "display:block;"
                }
                blogs.blogs.forEach(blog=>{
                    createBlogDiv(blog);
                })
            })

            function createBlogDiv(blog){
            // console.log(blog);
            let div1 = document.createElement("div");
            let div2 = document.createElement("div");
            let div3 = document.createElement("div");
            let div4 = document.createElement("div");
            let h1  =  document.createElement("h1");
            let h2  =  document.createElement("h5");

            h2.style = "color:rgb(199, 205, 17); padding-right:10px;"
            h1.innerText = blog.title;
            h2.innerText = `Author : ${blog.authorName}`
            div1.append(h1,h2);

            let p = document.createElement("p");
            p.innerText = blog.text;
            // console.log(p);
            div2.append(p);
            // console.log(div2);

            let button1 = document.createElement("button");
            button1.setAttribute("class", "btn");
            button1.innerText = "Comments";
            
            div3.append(button1);
            // console.log(div3);

            div4.append(div1);
            div4.append(div2);
            div4.append(div3);
            button1.style = "border:none; border-radius:3px; padding:5px; padding-left:10px;padding-right:10px; hover:background-color:red;"

            div1.style = "border-bottom:1px solid #999; color:black; display:flex; justify-content:space-between; align-item:center;"
            div2.style = "padding:20px;color:black;"
            div3.style = "display:flex; gap:15px;padding:10px;"
            div4.style = "box-shadow:1px 1px 3px grey;  display:flex; flex-direction:column; padding:10px; background-color:grey; border-radius:4px;"
            document.querySelector(".container").appendChild(div4);
            // console.log(div4);

            let div5 = document.createElement("div");
            div5.className = "comment";
            const input = document.createElement("input");
            input.setAttribute("type","text");
            input.setAttribute("name","comment");

            input.addEventListener("keypress",(e)=>{
                // console.log("user = ",user);
                if(e.key == "Enter"){ // login of commnet going to db and displayed
                    let comment = {
                        name : user.name,
                        comment : e.target.value.trim(),
                        id: blog._id
                    }
                    fetch("/user/blog/addComment",{
                        method:"POST",
                        headers:{
                            "Content-Type":"application/json"
                        },
                        body: JSON.stringify(comment)
                    })
                    .then(res=>res.json())
                    .then(res=>{
                        createCommentDiv(comment);
                    })
                }
            })

            input.style = "width:80%;border:none; border-bottom:0.5px solid black; background-color:grey; color:white;";
            input.setAttribute("placeholder","write your comment");
            div5.append(input);
            blog.comments.forEach(cmt=>{
                createCommentDiv(cmt);
            })
            div4.appendChild(div5);
            div5.style = "display:none;"

            function createCommentDiv(cmt){
                let div = document.createElement("div");
                let span1 = document.createElement("span");
                let span2 = document.createElement("span");
                span1.innerText = cmt.name;
                span2.innerText = cmt.comment;
                div.append(span1, span2);
                div5.append(div);
            }


            button1.addEventListener("click",async ()=>{
                button1.textContent = button1.textContent === "Comments" ? "Hide" : "Comments";
                if( button1.textContent == "Hide"){
                    div5.style = "display:block;"
                }
                else{
                   div5.style = "display:none;"
                }
            })

        }
         // FETCHING ALL BLOGS AND CREATING BOX FOR THIS  <END>
    </script>
</body>
</html>